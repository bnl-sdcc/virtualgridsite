# -----------------------------------------------------------------------------
#       PORTS 
# -----------------------------------------------------------------------------
COLLECTOR_PORT = 29619
PORT = 29619
SHARED_PORT_ARGS = -p 29619
CREDD_PORT = 29620
JOB_ROUTER_SCHEDD2_POOL = $(FULL_HOSTNAME):29618

# -----------------------------------------------------------------------------
#       HOOKS & ROUTING STUFF
# -----------------------------------------------------------------------------
JOB_ROUTER_HOOK_KEYWORD = NOVA
NOVA_HOOK_TRANSLATE_JOB = /usr/share/virtualgridsite/nova_hook_translate_job
NOVA_HOOK_UPDATE_JOB_INFO = /usr/share/virtualgridsite/nova_hook_update_job_info
NOVA_HOOK_JOB_EXIT = /usr/share/virtualgridsite/nova_hook_job_exit
NOVA_HOOK_JOB_CLEANUP = /usr/share/virtualgridsite/nova_hook_job_cleanup

LOCAL_CONFIG_FILE = /usr/share/virtualgridsite/condor_ce_router_defaults_nova|

# classad from the routed job that we want to propagate back to 
# the original ce job, so they can be condor_q'ed from the submit host
NOVA_ATTRS_TO_COPY = EC2ElasticIp

# routing table
JOB_ROUTER_ENTRIES = \
   [ \
     GridResource = "ec2 http://cldext02.usatlas.bnl.gov:8773/services/Cloud"; \
     TargetUniverse = 9; \
     set_EC2AccessKeyId = "/home/slot1/etc/key"; \
     set_EC2SecretAccessKey = "/home/slot1/etc/key.secret"; \
     set_EC2SecurityGroups = "default"; \
     set_EC2AmiId = "ami-0000001c"; \
     set_EC2InstanceType = "m1.medium"; \
     name = "RouteToEC2"; \
     Requirements = (TARGET.RouteToEC2 =?= "True");\
#    EditJobInPlace = True; \
   ] \
   [ \
     TargetUniverse = 5; \
     name = "Local_Condor_from_99"; \
     Requirements = (TARGET.RouteToEC2 =?= "False");\
   ]

# contrains to routed jobs
# this is basically to override the original one
# that seems to enforce JobUniverse 1 or 5
JOB_ROUTER_SOURCE_JOB_CONSTRAINT = (target.x509userproxysubject =!= UNDEFINED) && (target.x509UserProxyExpiration =!= UNDEFINED) && (time() < target.x509UserProxyExpiration)



# -----------------------------------------------------------------------------
#       INTERVALS 
# -----------------------------------------------------------------------------
NEGOTIATOR_INTERVAL = 30
NEGOTIATOR_UPDATE_INTERVAL = 30
UPDATE_INTERVAL = 30

# -----------------------------------------------------------------------------
#       MISC
# -----------------------------------------------------------------------------
ALL_DEBUG = D_ALL

# to prevent user to be able to fork jobs on the CE host
START_LOCAL_UNIVERSE = False
START_SCHEDULER_UNIVERSE = $(START_LOCAL_UNIVERSE)


